import{d as e,a,E as l,r as t,_ as o,ab as r,U as s,e as d,o as u,i,w as n,x as p,h as m,B as c,j as g,f,n as h,F as b,ac as v,a8 as w,m as V,ad as _,ae as y,V as I,af as D,ag as C,ah as L,t as S,ai as U}from"./index.3ccc0506.js";import{g as k}from"./roles.fb4ec0f6.js";import{f as q}from"./department.6fed1168.js";import{a as z,c as P}from"./FormValidation.dcbc89b2.js";import{u as O,_ as x,b as E}from"./usePagination.d50a23b4.js";const j=e("initStore",(()=>{const e=a([]),t=a([]);return{getRolesList:()=>new Promise(((a,t)=>{k().then((o=>{1==o.rspCode?(e.value=o.rspData.map((e=>({value:e.id,label:e.name,status:e.status}))),a(e)):(l.error("初始化车队列表失败"),t())}))})),getDepartmentList:()=>new Promise(((e,a)=>{q({}).then((l=>{var o,r;1==l.rspCode?(t.value=null==(r=null==(o=l.rspData)?void 0:o.list)?void 0:r.map((e=>({label:e.name,value:e.id}))),e(t)):a(new Error("请求部门列表"))}))})),DepartmentList:t,RolesList:e}})),B={formItems:[{field:"department",label:"部门:",placeholder:"请选择部门",type:"select",options:[]},{field:"username",label:"姓名:",placeholder:"请输入姓名",type:"input"},{field:"role",label:"角色:",placeholder:"请选择角色",type:"select",options:j().RolesList}]},F=t([{prop:"no",label:"员工编号",isShow:!0},{prop:"username",label:"姓名",isShow:!0},{prop:"account",label:"手机号",isShow:!0},{prop:"cropAccount",label:"企业微信账号",isShow:!0},{prop:"departmentList",label:"部门",isShow:!0},{prop:"roleList",label:"角色",isShow:!0,custom:!0},{prop:"cropDepartment",label:"企业微信部门",isShow:!0},{prop:"status",label:"员工状态",isShow:!0,custom:!0},{prop:"createDateTime",label:"创建时间",isShow:!0},{prop:"createBy",label:"创建人",isShow:!0},{prop:"handle",label:"操作",isShow:!0,custom:!0}]),W=t({no:[{required:!0,message:"请输入员工编号",trigger:"blur"}],username:[{required:!0,message:"请输入员工名称",trigger:"blur"},{min:2,max:10,message:"长度应为2-10位",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],account:[{validator:z,trigger:"blur"}],password:[{validator:P,message:"请输登录密码",trigger:"blur"}],departmentIdList:[{required:!0,message:"请选择部门",trigger:"blur"}],roleIdList:[{required:!0,message:"请选择角色",trigger:"blur"}]}),H={class:"dialog-footer"},R=o({__name:"index",props:{addUserDialogVisibility:{type:Boolean,required:!0},rules:{type:Object,required:!0},addOrEditHandleID:{type:Boolean,required:!0},form:{type:Object}},emits:["addDialogSave","addDialogOnCancel"],setup(e,{emit:l}){const t=e,o="170px",w=j(),V=a(),{addUserDialogVisibility:_,addOrEditHandleID:y,form:I}=r(t),D=()=>{l("addDialogOnCancel",V.value,I)};s((()=>{t.addOrEditHandleID.value}));const C=()=>{l("addDialogSave",V.value,I)};return(a,l)=>{const t=d("el-input"),r=d("el-form-item"),s=d("el-option"),L=d("el-select"),S=d("el-switch"),U=d("el-form"),k=d("el-button"),q=d("el-dialog");return u(),i(q,{"show-close":!1,width:"600px",modelValue:g(_),"onUpdate:modelValue":l[9]||(l[9]=e=>v(_)?_.value=e:null),onClose:D,title:1==g(y)?"添加员工":"编辑员工"},{footer:n((()=>[p("span",H,[m(k,{onClick:l[8]||(l[8]=e=>D(V.value))},{default:n((()=>[c("取消")])),_:1}),m(k,{type:"primary",onClick:C},{default:n((()=>[c(" 保存 ")])),_:1})])])),default:n((()=>[m(U,{rules:e.rules,ref_key:"addUserFormRef",ref:V,model:g(I)},{default:n((()=>[m(r,{label:"员工编号:","label-width":o,prop:"no",required:""},{default:n((()=>[m(t,{modelValue:g(I).no,"onUpdate:modelValue":l[0]||(l[0]=e=>g(I).no=e),class:"ItemWidth",placeholder:"请输入员工编号",autocomplete:"off"},null,8,["modelValue"])])),_:1}),m(r,{label:"员工名称:","label-width":o,prop:"username",required:""},{default:n((()=>[m(t,{modelValue:g(I).username,"onUpdate:modelValue":l[1]||(l[1]=e=>g(I).username=e),class:"ItemWidth",placeholder:"请输入员工名称",autocomplete:"off"},null,8,["modelValue"])])),_:1}),m(r,{label:"性别:","label-width":o,prop:"gender",required:""},{default:n((()=>[m(L,{class:"ItemWidth",placeholder:"请选择性别",modelValue:g(I).gender,"onUpdate:modelValue":l[2]||(l[2]=e=>g(I).gender=e)},{default:n((()=>[m(s,{label:"男",value:1}),m(s,{label:"女",value:0})])),_:1},8,["modelValue"])])),_:1}),m(r,{label:"登录账号:","label-width":o,prop:"account"},{default:n((()=>[m(t,{modelValue:g(I).account,"onUpdate:modelValue":l[3]||(l[3]=e=>g(I).account=e),placeholder:"请输入手机账号用于登录账号",class:"ItemWidth",autocomplete:"off"},null,8,["modelValue"])])),_:1}),m(r,{label:"登录密码:","label-width":o,prop:"password"},{default:n((()=>[m(t,{modelValue:g(I).password,"onUpdate:modelValue":l[4]||(l[4]=e=>g(I).password=e),placeholder:"请输入登录密码",class:"ItemWidth",autocomplete:"off"},null,8,["modelValue"])])),_:1}),m(r,{label:"部门:","label-width":o,prop:"departmentIdList",required:""},{default:n((()=>[m(L,{modelValue:g(I).departmentIdList,"onUpdate:modelValue":l[5]||(l[5]=e=>g(I).departmentIdList=e),multiple:"",placeholder:"请选择部门",class:"ItemWidth"},{default:n((()=>[m(s,{label:"男",value:1}),m(s,{label:"女",value:0})])),_:1},8,["modelValue"])])),_:1}),m(r,{label:"角色:",placeholder:"请选择角色",prop:"roleIdList","label-width":o,required:""},{default:n((()=>[m(L,{modelValue:g(I).roleIdList,"onUpdate:modelValue":l[6]||(l[6]=e=>g(I).roleIdList=e),multiple:"",class:"ItemWidth"},{default:n((()=>[(u(!0),f(b,null,h(g(w).RolesList,(e=>(u(),i(s,{key:e.label,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),m(r,{"label-width":o,label:"员工状态:"},{default:n((()=>[m(S,{modelValue:g(I).status,"onUpdate:modelValue":l[7]||(l[7]=e=>g(I).status=e),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue","title"])}}},[["__scopeId","data-v-5901e642"]]);const A={class:"app-container"},N={class:"pager-wrapper"},T=o({__name:"index",setup(e){var t;const o=a({}),r=a(!1),h=a(!0),{paginationData:b,handleCurrentChange:v,handleSizeChange:k}=O(),q=a(!1);s((()=>{$({}),j().getRolesList().then((e=>{B.formItems.forEach((a=>{"role"==a.field&&(a.options=e.value)}))})),j().getDepartmentList().then((e=>{B.formItems.forEach((a=>{"department"==a.field&&(a.options=e.value)}))}))}));const z=e=>{U.confirm(`正在删除用户：${e.username}，确认删除？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{var a;(a=e.id,w({url:`/account/deleteUserById/${a}`,method:"delete"})).then((()=>{l.success("删除成功"),$()}))}))},P=()=>{q.value=!0,h.value=!0},H=a([]),T=a(null),$=async e=>{r.value=!0,await function(e){return w({url:"/account/queryUserList",method:"post",data:e||{}})}({...e,pageNum:b.currentPage,pageSize:b.pageSize}).then((e=>{const{pageNum:a,total:l,list:t}=e.rspData;r.value=!1,b.total=l,H.value=t,b.currentPage=a})).catch((()=>{H.value=[]})).finally((()=>{r.value=!1}))},G=()=>{1===b.currentPage&&$(M.value),b.currentPage=1},J=null!=(t=null==B?void 0:B.formItems)?t:[],K={};J.map((e=>{K[e.field]=""}));const M=a(K),Q=()=>{var e;null==(e=T.value)||e.resetForm(),1===b.currentPage&&$(),b.currentPage=1},X=async(e,a)=>{e&&await e.validate(((t,o)=>{var r;t&&((r=a.value,w({url:"/account/editUser",method:"post",data:r||{}})).then((e=>{1==e.rspCode&&($(),1==h.value?l.success("新增成功"):l.success("修改成功"))})),q.value=!1,e.resetFields())}))},Y=e=>{e.resetFields(),q.value=!1};return V([()=>b.currentPage,()=>b.pageSize],$),(e,a)=>{const l=d("el-button"),t=d("el-pagination"),s=d("el-card"),w=_("loading");return u(),f("div",A,[m(x,y(g(B),{modelValue:M.value,"onUpdate:modelValue":a[0]||(a[0]=e=>M.value=e),ref_key:"editForm",ref:T}),{lastBtn:n((()=>[m(l,{type:"primary",icon:g(D),onClick:G},{default:n((()=>[c("查询")])),_:1},8,["icon"]),m(l,{icon:g(C),onClick:Q},{default:n((()=>[c("重置")])),_:1},8,["icon"])])),_:1},16,["modelValue"]),I((u(),i(s,null,{default:n((()=>[m(E,{tableData:H.value,columnList:g(F)},{OtherHandle:n((()=>[m(l,{type:"primary",icon:g(L),onClick:P},{default:n((()=>[c("新增")])),_:1},8,["icon"])])),status:n((e=>[p("div",null,S(e.row.status?"正常":"停用"),1)])),roleList:n((e=>[p("div",null,S(e.row.roleList[0]?e.row.roleList[0].roleName:""),1)])),handle:n((e=>[m(l,{type:"primary",link:"",size:"small",onClick:a=>{return l=e.row,o.value=l,o.value,h.value=!1,void(q.value=!0);var l}},{default:n((()=>[c("修改")])),_:2},1032,["onClick"]),m(l,{type:"danger",link:"",size:"small",onClick:a=>z(e.row)},{default:n((()=>[c("删除")])),_:2},1032,["onClick"])])),_:1},8,["tableData","columnList"]),p("div",N,[m(t,{background:"",layout:g(b).layout,"page-sizes":g(b).pageSizes,total:g(b).total,"page-size":g(b).pageSize,currentPage:g(b).currentPage,onSizeChange:g(k),onCurrentChange:g(v)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])),_:1})),[[w,r.value]]),m(R,{rules:g(W),form:o.value,addOrEditHandleID:h.value,addUserDialogVisibility:q.value,onAddDialogOnCancel:Y,onAddDialogSave:X},null,8,["rules","form","addOrEditHandleID","addUserDialogVisibility"])])}}},[["__scopeId","data-v-53ba2f28"]]);export{T as default};
