import{a8 as e,d as l,a,E as t,r as o,_ as r,P as d,U as i,m as p,e as u,ad as s,o as n,f as c,h as m,w as v,ae as f,j as h,V as b,i as g,af as y,B as _,ag as V,ah as C,x as k,t as w,F as S,n as x,ai as D,C as q}from"./index.da4b159e.js";import{u as z,_ as I,b as L}from"./usePagination.21c10505.js";import{g as P}from"./fleet.32b65d60.js";import{a as R,b as U}from"./FormValidation.dcbc89b2.js";const F=l("fleetStore",(()=>{const e=a([]);return{getFleet:l=>new Promise(((a,o)=>{P(l).then((l=>{1==l.rspCode?(e.value=l.rspData.data.map((e=>({label:e.name,value:e.id}))),a(e)):t.error("初始化车队列表失败")})).catch((e=>{o(e)}))})),fleetList:e}})),j={formItems:[{field:"fleetId",label:"所属车队:",placeholder:"请选择所属车队",type:"select",options:[]},{field:"name",label:"司机姓名:",type:"input",placeholder:"请输入司机姓名"},{field:"phone",label:"手机号:",type:"input",placeholder:"请输入手机号"},{field:"idcardNo",label:"身份证号:",type:"input",placeholder:"请输入身份证号"},{field:"gender",label:"性别:",type:"select",placeholder:"请选择性别",options:[{label:"男",value:1},{label:"女",value:0}]}]},N=o([{prop:"fleet",label:"车队",isShow:!0},{prop:"name",label:"司机名称",isShow:!0},{prop:"phone",label:"手机号",isShow:!0},{prop:"idcardNo",label:"身份证号",isShow:!0},{prop:"driverLicenseType",label:"驾驶证类型",isShow:!0},{prop:"dateIssue",label:"领证日期",isShow:!0},{prop:"gender",label:"性别",isShow:!0,custom:!0},{prop:"createDateTime",label:"创建日期",isShow:!0},{prop:"createBy",label:"创建人",isShow:!0},{prop:"handle",label:"操作",isShow:!0,custom:!0}]),T=o([{prop:"fleetId",label:"车队",placeholder:"请选择车队",type:"select",isRequire:!1,options:[]},{prop:"type",label:"司机类型",placeholder:"请选择类型",type:"select",isRequire:!1,options:[{label:"公海司机",value:"123"},{label:"直营司机",value:"456"}]},{prop:"name",label:"姓名",placeholder:"请输入姓名",type:"input",isRequire:!0},{prop:"idcardNo",label:"身份证",placeholder:"请输入身份证号",type:"input",isRequire:!0},{prop:"gender",label:"性别",placeholder:"请选择性别",type:"select",isRequire:!0,options:[{label:"男",value:1},{label:"女",value:0}]},{prop:"phone",label:"手机号",placeholder:"请输入手机号",type:"input",isRequire:!1},{prop:"driverLicenseType",label:"驾驶证类型",placeholder:"情选择驾驶证类型",type:"select",isRequire:!0,options:[{label:"C1",value:1},{label:"C2",value:2}]},{prop:"dateIssue",label:"领证日期",placeholder:"请选择日期",type:"datepicker",isRequire:!0},{prop:"nodesId",label:"网点",placeholder:"请选择网点",type:"select",isRequire:!1,options:[{label:"上海",value:1},{label:"北京",value:2}]}]),B={phone:[{validator:R,trigger:"blur"}],idcardNo:[{validator:U,trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"blur"}]},Y={class:"app-container"},E={class:"pager-wrapper"},M={class:"addDriverDialogTitle"},O={class:"dialog-footer"},$=r({__name:"index",setup(l){var r;const P=F(),{fleetList:R}=d(P),{paginationData:U,handleCurrentChange:$,handleSizeChange:H}=z(),W=a(),A=o({}),G=a([]),J=a("add"),K=a(!1),Q=a(!1),X=a(),Z=null!=(r=null==j?void 0:j.formItems)?r:[],ee={};Z.map((e=>{ee[e.field]=""}));const le=a(ee),ae=()=>{var e;null==(e=X.value)||e.resetForm(),de(),U.currentPage=1},te=()=>{de(le.value)},oe=()=>{var e;null==(e=W.value)||e.resetFields(),J.value="add",K.value=!0},re=()=>{var l;"add"==J.value?(l=A,e({url:"/vehicle/driver/addDriver",method:"post",data:l||{}})).then((e=>{1==e.rspCode&&(t.success("新增成功"),K.value=!1,de())})):((l={})=>e({url:"/vehicle/driver/editDriver",method:"post",data:l||{}}))(A).then((e=>{1==e.rspCode&&(t.success("修改成功"),K.value=!1,de())}))},de=async l=>{Q.value=!0,await function(l){return e({url:"/vehicle/driver/driverList",method:"post",data:l||{}})}({...l,pageNum:U.currentPage,pageSize:U.pageSize}).then((e=>{Q.value=!1;const{pageNum:l,total:a,data:t}=e.rspData;U.currentPage=l,U.total=a,G.value=t}))},ie=l=>{D.confirm(`即将删除司机${l.name}?`,"Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{var a;(a=l.id,e({url:`/vehicle/driver/deleteDriver/${a}`,method:"delete"})).then((e=>{1==e.rspCode&&(t.success("删除完成"),de())}))})).catch((()=>{t.danger("删除失败,请联系管理员")}))};i((()=>{de({}),P.getFleet().then((()=>{j.formItems.forEach((e=>{"fleetId"==e.field&&(e.options=R.value)})),T.forEach((e=>{"fleetId"==e.prop&&(e.options=R.value)}))}))}));const pe=()=>{var e;K.value=!1,null==(e=W.value)||e.resetFields()};return p([()=>U.currentPage,()=>U.pageSize],de),(e,l)=>{const a=u("el-button"),t=u("el-pagination"),o=u("el-card"),r=u("el-option"),d=u("el-select"),i=u("el-date-picker"),p=u("el-input"),D=u("el-form-item"),z=u("el-col"),P=u("Plus"),R=u("el-icon"),F=u("el-upload"),Z=u("el-row"),ee=u("el-form"),de=u("el-dialog"),ue=s("loading");return n(),c("div",Y,[m(I,f(h(j),{modelValue:le.value,"onUpdate:modelValue":l[0]||(l[0]=e=>le.value=e),ref_key:"editForm",ref:X}),{lastBtn:v((()=>[m(a,{type:"primary",icon:h(y),onClick:te},{default:v((()=>[_("查询")])),_:1},8,["icon"]),m(a,{icon:h(V),onClick:ae},{default:v((()=>[_("重置")])),_:1},8,["icon"])])),_:1},16,["modelValue"]),b((n(),g(o,null,{default:v((()=>[m(L,{tableData:G.value,columnList:h(N)},{OtherHandle:v((()=>[m(a,{type:"primary",icon:h(C),onClick:oe},{default:v((()=>[_("新增司机")])),_:1},8,["icon"])])),gender:v((e=>[k("div",null,w("1"==e.row.gender?"男":"女"),1)])),handle:v((e=>[m(a,{type:"primary",text:"",size:"small",onClick:l=>{return a=e.row,J.value="edit",K.value=!0,void Object.assign(A,a);var a}},{default:v((()=>[_("编辑")])),_:2},1032,["onClick"]),m(a,{type:"danger",text:"",size:"small",onClick:l=>ie(e.row)},{default:v((()=>[_("删除")])),_:2},1032,["onClick"])])),_:1},8,["tableData","columnList"]),k("div",E,[m(t,{layout:h(U).layout,"page-sizes":h(U).pageSizes,total:h(U).total,"page-size":h(U).pageSize,currentPage:h(U).currentPage,onSizeChange:h(H),onCurrentChange:h($)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])),_:1})),[[ue,Q.value]]),m(de,{modelValue:K.value,"onUpdate:modelValue":l[3]||(l[3]=e=>K.value=e)},{header:v((()=>[k("div",M,w("add"==J.value?"新增司机":"编辑司机"),1)])),footer:v((()=>[k("span",O,[m(a,{onClick:pe},{default:v((()=>[_("取消")])),_:1}),m(a,{type:"primary",onClick:re},{default:v((()=>[_("保存 ")])),_:1})])])),default:v((()=>[m(ee,{ref_key:"addDriverDialogFormRef",ref:W,rules:h(B),model:A,"label-width":"120px"},{default:v((()=>[m(Z,null,{default:v((()=>[(n(!0),c(S,null,x(h(T),(e=>(n(),g(z,{xs:24,sm:14,md:12,lg:10,xl:8,key:e.prop},{default:v((()=>[m(D,{label:e.label,required:e.isRequire,prop:e.prop,class:"addDriverItem"},{default:v((()=>[e.options?(n(),g(d,{key:0,modelValue:A[e.prop],"onUpdate:modelValue":l=>A[e.prop]=l,placeholder:e.placeholder},{default:v((()=>[(n(!0),c(S,null,x(e.options,(e=>(n(),g(r,{key:e.label,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):q("",!0),"datepicker"==e.type?(n(),g(i,{key:1,modelValue:A[e.prop],"onUpdate:modelValue":l=>A[e.prop]=l,type:"date",format:"YYYY/MM/DD","value-format":"x",placeholder:"请选择日期"},null,8,["modelValue","onUpdate:modelValue"])):q("",!0),"input"==e.type?(n(),g(p,{key:2,modelValue:A[e.prop],"onUpdate:modelValue":l=>A[e.prop]=l,placeholder:e.placeholder},null,8,["modelValue","onUpdate:modelValue","placeholder"])):q("",!0)])),_:2},1032,["label","required","prop"])])),_:2},1024)))),128)),m(z,{xs:24,sm:14,md:12,lg:10,xl:8},{default:v((()=>[m(D,{label:"上传驾照",required:""},{default:v((()=>[m(F,{modelValue:A.fileList,"onUpdate:modelValue":l[1]||(l[1]=e=>A.fileList=e),action:"https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15","list-type":"picture-card"},{default:v((()=>[m(R,null,{default:v((()=>[m(P)])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),m(z,{xs:24,sm:14,md:12,lg:10,xl:9},{default:v((()=>[m(D,{"label-width":"140px",label:"上传网约车运输证"},{default:v((()=>[m(F,{modelValue:A.fileList,"onUpdate:modelValue":l[2]||(l[2]=e=>A.fileList=e),action:"https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15","list-type":"picture-card"},{default:v((()=>[m(R,null,{default:v((()=>[m(P)])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-a07c85f4"]]);export{$ as default};
