import{a8 as e,d as l,a,E as t,r as o,_ as r,P as d,U as i,m as p,e as u,ad as s,o as n,f as c,h as m,w as v,ae as f,j as h,V as b,i as g,ag as y,B as _,ah as C,ai as V,x as k,t as w,F as S,n as x,al as D,af as q,C as z}from"./index.7c4629cc.js";import{u as I,_ as F,b as L}from"./usePagination.bd041eb4.js";import{g as P}from"./fleet.38d02fa8.js";import{a as R,b as U}from"./FormValidation.4fab5f63.js";const N=l("fleetStore",(()=>{const e=a([]);return{getFleet:l=>new Promise(((a,o)=>{P(l).then((l=>{1==l.rspCode?(e.value=l.rspData.data.map((e=>({label:e.name,value:e.id}))),a(e)):t.error("初始化车队列表失败")})).catch((e=>{o(e)}))})),fleetList:e}})),j={formItems:[{field:"fleetId",label:"所属车队:",placeholder:"请选择所属车队",type:"select",options:[]},{field:"name",label:"司机姓名:",type:"input",placeholder:"请输入司机姓名"},{field:"phone",label:"手机号:",type:"input",placeholder:"请输入手机号"},{field:"idcardNo",label:"身份证号:",type:"input",placeholder:"请输入身份证号"},{field:"gender",label:"性别:",type:"select",placeholder:"请选择性别",options:[{label:"男",value:1},{label:"女",value:0}]}]},T=o([{prop:"fleetName",label:"车队",isShow:!0},{prop:"name",label:"司机名称",isShow:!0},{prop:"phone",label:"手机号",isShow:!0},{prop:"idcardNo",label:"身份证号",isShow:!0},{prop:"driverLicenseType",label:"驾驶证类型",isShow:!0},{prop:"dateIssue",label:"领证日期",isShow:!0},{prop:"gender",label:"性别",isShow:!0,custom:!0},{prop:"createDateTime",label:"创建日期",isShow:!0},{prop:"createBy",label:"创建人",isShow:!0},{prop:"handle",label:"操作",isShow:!0,custom:!0}]),B=o([{prop:"fleetId",label:"车队",placeholder:"请选择车队",type:"select",isRequire:!1,options:[]},{prop:"type",label:"司机类型",placeholder:"请选择类型",type:"select",isRequire:!1,options:[{label:"公海司机",value:"123"},{label:"直营司机",value:"456"}]},{prop:"name",label:"姓名",placeholder:"请输入姓名",type:"input",isRequire:!0},{prop:"idcardNo",label:"身份证",placeholder:"请输入身份证号",type:"input",isRequire:!0},{prop:"gender",label:"性别",placeholder:"请选择性别",type:"select",isRequire:!0,options:[{label:"男",value:1},{label:"女",value:0}]},{prop:"phone",label:"手机号",placeholder:"请输入手机号",type:"input",isRequire:!1},{prop:"driverLicenseType",label:"驾驶证类型",placeholder:"情选择驾驶证类型",type:"select",isRequire:!0,options:[{label:"C1",value:1},{label:"C2",value:2}]},{prop:"dateIssue",label:"领证日期",placeholder:"请选择日期",type:"datepicker",isRequire:!0},{prop:"nodesId",label:"网点",placeholder:"请选择网点",type:"select",isRequire:!1,options:[{label:"上海",value:1},{label:"北京",value:2}]}]),Y={phone:[{validator:R,trigger:"blur"}],idcardNo:[{validator:U,trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"blur"}]},E={class:"app-container"},M={class:"pager-wrapper"},O={class:"addDriverDialogTitle"},$={class:"dialog-footer"},H=r({__name:"index",setup(l){var r;const P=N(),{fleetList:R}=d(P),{paginationData:U,handleCurrentChange:H,handleSizeChange:W}=I(),A=a({}),G=o({}),J=a([]),K=a("add"),Q=a(!1),X=a(!1),Z=a(),ee=null!=(r=null==j?void 0:j.formItems)?r:[],le={};ee.map((e=>{le[e.field]=""}));const ae=a(le),te=()=>{var e;null==(e=Z.value)||e.resetForm(),ie(),U.currentPage=1},oe=()=>{ie(ae.value)},re=()=>{K.value="add",Q.value=!0,G.value={}},de=()=>{var l;"add"==K.value?(l=G,e({url:"/vehicle/driver/addDriver",method:"post",data:l||{}})).then((e=>{var l;1==e.rspCode&&(t.success("新增成功"),Q.value=!1,null==(l=null==A?void 0:A.value)||l.resetFields(),ie())})):((l={})=>e({url:"/vehicle/driver/editDriver",method:"post",data:l||{}}))(G).then((e=>{var l;1==e.rspCode&&(t.success("修改成功"),Q.value=!1,null==(l=null==A?void 0:A.value)||l.resetFields(),ie())}))},ie=async l=>{X.value=!0,await function(l){return e({url:"/vehicle/driver/driverList",method:"post",data:l||{}})}({...l,pageNum:U.currentPage,pageSize:U.pageSize}).then((e=>{X.value=!1;const{pageNum:l,total:a,data:t}=e.rspData;U.currentPage=l,U.total=a,J.value=t}))},pe=()=>{var e;null==(e=null==A?void 0:A.value)||e.resetFields()},ue=l=>{D.confirm(`即将删除司机${l.name}?`,"Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{var a;(a=l.id,e({url:`/vehicle/driver/deleteDriver/${a}`,method:"delete"})).then((e=>{1==e.rspCode&&(t.success("删除完成"),ie())}))})).catch((()=>{t.danger("删除失败,请联系管理员")}))};i((()=>{ie({}),P.getFleet().then((()=>{j.formItems.forEach((e=>{"fleetId"==e.field&&(e.options=R.value)})),B.forEach((e=>{"fleetId"==e.prop&&(e.options=R.value)}))}))}));const se=()=>{var e;Q.value=!1,null==(e=null==A?void 0:A.value)||e.resetFields()};return p([()=>U.currentPage,()=>U.pageSize],ie),(e,l)=>{const a=u("el-button"),t=u("el-pagination"),o=u("el-card"),r=u("el-option"),d=u("el-select"),i=u("el-date-picker"),p=u("el-input"),D=u("el-form-item"),I=u("el-col"),P=u("Plus"),R=u("el-icon"),N=u("el-upload"),ee=u("el-row"),le=u("el-form"),ie=u("el-dialog"),ne=s("loading");return n(),c("div",E,[m(F,f(h(j),{modelValue:ae.value,"onUpdate:modelValue":l[0]||(l[0]=e=>ae.value=e),ref_key:"editForm",ref:Z}),{lastBtn:v((()=>[m(a,{type:"primary",icon:h(y),onClick:oe},{default:v((()=>[_("查询")])),_:1},8,["icon"]),m(a,{icon:h(C),onClick:te},{default:v((()=>[_("重置")])),_:1},8,["icon"])])),_:1},16,["modelValue"]),b((n(),g(o,null,{default:v((()=>[m(L,{tableData:J.value,columnList:h(T)},{OtherHandle:v((()=>[m(a,{type:"primary",icon:h(V),onClick:re},{default:v((()=>[_("新增司机")])),_:1},8,["icon"])])),gender:v((e=>[k("div",null,w("1"==e.row.gender?"男":"女"),1)])),handle:v((e=>[m(a,{type:"primary",text:"",size:"small",onClick:l=>{return a=e.row,K.value="edit",Q.value=!0,void q((()=>{Object.assign(G,a)}));var a}},{default:v((()=>[_("编辑")])),_:2},1032,["onClick"]),m(a,{type:"danger",text:"",size:"small",onClick:l=>ue(e.row)},{default:v((()=>[_("删除")])),_:2},1032,["onClick"])])),_:1},8,["tableData","columnList"]),k("div",M,[m(t,{layout:h(U).layout,"page-sizes":h(U).pageSizes,total:h(U).total,"page-size":h(U).pageSize,currentPage:h(U).currentPage,onSizeChange:h(W),onCurrentChange:h(H)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])),_:1})),[[ne,X.value]]),m(ie,{modelValue:Q.value,"onUpdate:modelValue":l[3]||(l[3]=e=>Q.value=e),onClosed:pe},{header:v((()=>[k("div",O,w("add"==K.value?"新增司机":"编辑司机"),1)])),footer:v((()=>[k("span",$,[m(a,{onClick:se},{default:v((()=>[_("取消")])),_:1}),m(a,{type:"primary",onClick:de},{default:v((()=>[_("保存 ")])),_:1})])])),default:v((()=>[m(le,{ref_key:"addDriverDialogFormRef",ref:A,rules:h(Y),model:G,"label-width":"120px"},{default:v((()=>[m(ee,null,{default:v((()=>[(n(!0),c(S,null,x(h(B),(e=>(n(),g(I,{xs:24,sm:14,md:12,lg:10,xl:8,key:e.prop},{default:v((()=>[m(D,{label:e.label,required:e.isRequire,prop:e.prop,class:"addDriverItem"},{default:v((()=>[e.options?(n(),g(d,{key:0,modelValue:G[e.prop],"onUpdate:modelValue":l=>G[e.prop]=l,placeholder:e.placeholder},{default:v((()=>[(n(!0),c(S,null,x(e.options,(e=>(n(),g(r,{key:e.label,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):z("",!0),"datepicker"==e.type?(n(),g(i,{key:1,modelValue:G[e.prop],"onUpdate:modelValue":l=>G[e.prop]=l,type:"date",format:"YYYY/MM/DD","value-format":"x",placeholder:"请选择日期"},null,8,["modelValue","onUpdate:modelValue"])):z("",!0),"input"==e.type?(n(),g(p,{key:2,modelValue:G[e.prop],"onUpdate:modelValue":l=>G[e.prop]=l,placeholder:e.placeholder},null,8,["modelValue","onUpdate:modelValue","placeholder"])):z("",!0)])),_:2},1032,["label","required","prop"])])),_:2},1024)))),128)),m(I,{xs:24,sm:14,md:12,lg:10,xl:8},{default:v((()=>[m(D,{label:"上传驾照",required:""},{default:v((()=>[m(N,{modelValue:G.fileList,"onUpdate:modelValue":l[1]||(l[1]=e=>G.fileList=e),action:"https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15","list-type":"picture-card"},{default:v((()=>[m(R,null,{default:v((()=>[m(P)])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),m(I,{xs:24,sm:14,md:12,lg:10,xl:9},{default:v((()=>[m(D,{"label-width":"140px",label:"上传网约车运输证"},{default:v((()=>[m(N,{modelValue:G.fileList,"onUpdate:modelValue":l[2]||(l[2]=e=>G.fileList=e),action:"https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15","list-type":"picture-card"},{default:v((()=>[m(R,null,{default:v((()=>[m(P)])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-4adeaeb3"]]);export{H as default};
