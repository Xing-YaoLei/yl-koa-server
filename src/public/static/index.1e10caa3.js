import{a8 as e,d as l,a,E as t,r as o,_ as r,P as d,U as i,m as p,e as s,ad as u,o as n,f as c,h as m,w as f,ae as h,j as v,V as b,i as g,af as y,B as _,ag as C,ah as V,x as k,t as w,F as S,n as x,ai as D,C as q}from"./index.729f6c65.js";import{u as z,_ as I,b as L}from"./usePagination.0efc074a.js";import{g as P}from"./fleet.7281116d.js";import{a as R,b as U}from"./FormValidation.dcbc89b2.js";const F=l("fleetStore",(()=>{const e=a([]);return{getFleet:l=>new Promise(((a,o)=>{P(l).then((l=>{1==l.rspCode?(e.value=l.rspData.data.map((e=>({label:e.name,value:e.id}))),a(e)):t.error("初始化车队列表失败")})).catch((e=>{o(e)}))})),fleetList:e}})),j={formItems:[{field:"fleetId",label:"所属车队:",placeholder:"请选择所属车队",type:"select",options:[]},{field:"name",label:"司机姓名:",type:"input",placeholder:"请输入司机姓名"},{field:"phone",label:"手机号:",type:"input",placeholder:"请输入手机号"},{field:"idcardNo",label:"身份证号:",type:"input",placeholder:"请输入身份证号"},{field:"gender",label:"性别:",type:"select",placeholder:"请选择性别",options:[{label:"男",value:1},{label:"女",value:0}]}]},N=o([{prop:"fleet",label:"车队",isShow:!0},{prop:"name",label:"司机名称",isShow:!0},{prop:"phone",label:"手机号",isShow:!0},{prop:"idcardNo",label:"身份证号",isShow:!0},{prop:"driverLicenseType",label:"驾驶证类型",isShow:!0},{prop:"dateIssue",label:"领证日期",isShow:!0},{prop:"gender",label:"性别",isShow:!0},{prop:"createDateTime",label:"创建日期",isShow:!0},{prop:"createBy",label:"创建人",isShow:!0},{prop:"status",label:"停用状态",isShow:!0,custom:!0},{prop:"handle",label:"操作",isShow:!0,custom:!0}]),T=o([{prop:"fleetId",label:"车队",placeholder:"请选择车队",type:"select",isRequire:!1,options:[]},{prop:"type",label:"司机类型",placeholder:"请选择类型",type:"select",isRequire:!1,options:[{label:"公海司机",value:"123"},{label:"直营司机",value:"456"}]},{prop:"name",label:"姓名",placeholder:"请输入姓名",type:"input",isRequire:!0},{prop:"idcardNo",label:"身份证",placeholder:"请输入身份证号",type:"input",isRequire:!0},{prop:"gender",label:"性别",placeholder:"请选择性别",type:"select",isRequire:!0,options:[{label:"男",value:1},{label:"女",value:0}]},{prop:"phone",label:"手机号",placeholder:"请输入手机号",type:"input",isRequire:!1},{prop:"drivingLicenceType",label:"驾驶证类型",placeholder:"情选择驾驶证类型",type:"select",isRequire:!0,options:[{label:"C1",value:1},{label:"C2",value:2}]},{prop:"dateIssue",label:"领证日期",placeholder:"请选择日期",type:"datepicker",isRequire:!0},{prop:"nodesId",label:"网点",placeholder:"请选择网点",type:"select",isRequire:!1,options:[{label:"上海",value:1},{label:"北京",value:2}]}]),B={phone:[{validator:R,trigger:"blur"}],idcardNo:[{validator:U,trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"blur"}]},Y={class:"app-container"},E=["onClick"],M={key:0,style:{color:"blue"}},O={key:1,style:{color:"#999999"}},$={class:"pager-wrapper"},H={class:"addDriverDialogTitle"},W={class:"dialog-footer"},A=r({__name:"index",setup(l){var r;const P=F(),{fleetList:R}=d(P),{paginationData:U,handleCurrentChange:A,handleSizeChange:G}=z(),J=a(),K=o({}),Q=a([]),X=a("add"),Z=a(!1),ee=a(!1),le=a(),ae=null!=(r=null==j?void 0:j.formItems)?r:[],te={};ae.map((e=>{te[e.field]=""}));const oe=a(te),re=()=>{var e;null==(e=le.value)||e.resetForm(),se(),U.currentPage=1},de=()=>{se(oe.value)},ie=()=>{var e;null==(e=J.value)||e.resetFields(),X.value="add",Z.value=!0},pe=()=>{var l;"add"==X.value?(l=K,e({url:"/vehicle/driver/addDriver",method:"post",data:l||{}})).then((e=>{1==e.rspCode&&t.success("新增成功")})):((l={})=>e({url:"/vehicle/driver/editDriver",method:"post",data:l||{}}))(K).then((e=>{1==e.rspCode&&t.success("修改成功")}))},se=async l=>{ee.value=!0,await function(l){return e({url:"/vehicle/driver/driverList",method:"post",data:l||{}})}({...l,pageNum:U.currentPage,pageSize:U.pageSize}).then((e=>{ee.value=!1;const{pageNum:l,total:a,data:t}=e.rspData;U.currentPage=l,U.total=a,Q.value=t}))},ue=l=>{D.confirm(`即将删除司机${l.name}?`,"Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{var a;(a=l.id,e({url:`/vehicle/driver/deleteDriver/${a}`,method:"delete"})).then((e=>{1==e.rspCode&&(t.success("删除完成"),se())}))})).catch((()=>{t.danger("删除失败,请联系管理员")}))};i((()=>{se({}),P.getFleet().then((()=>{j.formItems.forEach((e=>{"fleetId"==e.field&&(e.options=R.value)})),T.forEach((e=>{"fleetId"==e.prop&&(e.options=R.value)}))}))}));const ne=()=>{var e;Z.value=!1,null==(e=J.value)||e.resetFields()};return p([()=>U.currentPage,()=>U.pageSize],se),(e,l)=>{const a=s("el-button"),t=s("el-pagination"),o=s("el-card"),r=s("el-option"),d=s("el-select"),i=s("el-date-picker"),p=s("el-input"),D=s("el-form-item"),z=s("el-col"),P=s("Plus"),R=s("el-icon"),F=s("el-upload"),ae=s("el-row"),te=s("el-form"),se=s("el-dialog"),ce=u("loading");return n(),c("div",Y,[m(I,h(v(j),{modelValue:oe.value,"onUpdate:modelValue":l[0]||(l[0]=e=>oe.value=e),ref_key:"editForm",ref:le}),{lastBtn:f((()=>[m(a,{type:"primary",icon:v(y),onClick:de},{default:f((()=>[_("查询")])),_:1},8,["icon"]),m(a,{icon:v(C),onClick:re},{default:f((()=>[_("重置")])),_:1},8,["icon"])])),_:1},16,["modelValue"]),b((n(),g(o,null,{default:f((()=>[m(L,{tableData:Q.value,columnList:v(N)},{OtherHandle:f((()=>[m(a,{type:"primary",icon:v(V),onClick:ie},{default:f((()=>[_("新增司机")])),_:1},8,["icon"])])),status:f((e=>[k("div",{style:{cursor:"pointer"},onClick:l=>e.row.status=!e.row.status},[1==e.row.status?(n(),c("span",M," 正常 ")):(n(),c("span",O," 停用 "))],8,E)])),handle:f((e=>[m(a,{type:"primary",text:"",size:"small",onClick:l=>{return a=e.row,X.value="edit",Z.value=!0,void Object.assign(K,a);var a}},{default:f((()=>[_("编辑")])),_:2},1032,["onClick"]),m(a,{type:"danger",text:"",size:"small",onClick:l=>ue(e.row)},{default:f((()=>[_("删除")])),_:2},1032,["onClick"])])),_:1},8,["tableData","columnList"]),k("div",$,[m(t,{layout:v(U).layout,"page-sizes":v(U).pageSizes,total:v(U).total,"page-size":v(U).pageSize,currentPage:v(U).currentPage,onSizeChange:v(G),onCurrentChange:v(A)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])),_:1})),[[ce,ee.value]]),m(se,{modelValue:Z.value,"onUpdate:modelValue":l[3]||(l[3]=e=>Z.value=e)},{header:f((()=>[k("div",H,w("add"==X.value?"新增司机":"编辑司机"),1)])),footer:f((()=>[k("span",W,[m(a,{onClick:ne},{default:f((()=>[_("取消")])),_:1}),m(a,{type:"primary",onClick:pe},{default:f((()=>[_("保存 ")])),_:1})])])),default:f((()=>[m(te,{ref_key:"addDriverDialogFormRef",ref:J,rules:v(B),model:K,"label-width":"120px"},{default:f((()=>[m(ae,null,{default:f((()=>[(n(!0),c(S,null,x(v(T),(e=>(n(),g(z,{xs:24,sm:14,md:12,lg:10,xl:8,key:e.prop},{default:f((()=>[m(D,{label:e.label,required:e.isRequire,prop:e.prop,class:"addDriverItem"},{default:f((()=>[e.options?(n(),g(d,{key:0,modelValue:K[e.prop],"onUpdate:modelValue":l=>K[e.prop]=l,placeholder:e.placeholder},{default:f((()=>[(n(!0),c(S,null,x(e.options,(e=>(n(),g(r,{key:e.label,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):q("",!0),"datepicker"==e.type?(n(),g(i,{key:1,modelValue:K[e.prop],"onUpdate:modelValue":l=>K[e.prop]=l,type:"date",format:"YYYY/MM/DD","value-format":"x",placeholder:"请选择日期"},null,8,["modelValue","onUpdate:modelValue"])):q("",!0),"input"==e.type?(n(),g(p,{key:2,modelValue:K[e.prop],"onUpdate:modelValue":l=>K[e.prop]=l,placeholder:e.placeholder},null,8,["modelValue","onUpdate:modelValue","placeholder"])):q("",!0)])),_:2},1032,["label","required","prop"])])),_:2},1024)))),128)),m(z,{xs:24,sm:14,md:12,lg:10,xl:8},{default:f((()=>[m(D,{label:"上传驾照",required:""},{default:f((()=>[m(F,{modelValue:K.fileList,"onUpdate:modelValue":l[1]||(l[1]=e=>K.fileList=e),action:"https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15","list-type":"picture-card"},{default:f((()=>[m(R,null,{default:f((()=>[m(P)])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),m(z,{xs:24,sm:14,md:12,lg:10,xl:9},{default:f((()=>[m(D,{"label-width":"140px",label:"上传网约车运输证"},{default:f((()=>[m(F,{modelValue:K.fileList,"onUpdate:modelValue":l[2]||(l[2]=e=>K.fileList=e),action:"https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15","list-type":"picture-card"},{default:f((()=>[m(R,null,{default:f((()=>[m(P)])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-bd60ccd4"]]);export{A as default};
